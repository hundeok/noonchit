\n\n// ====== lib/core/di/settings_provider.dart ======\n
// 1ï¸âƒ£ lib/core/di/settings_provider.dart (ìˆ˜ì •)
// ==========================================
import 'package:flutter/material.dart';
import 'package:flutter_riverpod/flutter_riverpod.dart';
import 'package:shared_preferences/shared_preferences.dart';
import 'package:wakelock_plus/wakelock_plus.dart';
import '../../data/datasources/settings_local_ds.dart';
import '../../data/repositories/settings_repository_impl.dart';
import '../../domain/entities/app_settings.dart';
import '../../domain/repositories/settings_repository.dart';
import '../../domain/usecases/settings_usecase.dart';
import '../utils/logger.dart';

/// 1) SharedPreferences ì¸ìŠ¤í„´ìŠ¤ (main.dartì—ì„œ override)
final sharedPreferencesProvider = Provider<SharedPreferences>((ref) {
  throw UnimplementedError(
    'main.dartì—ì„œ SharedPreferences.getInstance() í›„ overridesë¡œ ì£¼ì…í•˜ì„¸ìš”.'
  );
});

/// 2) Local DataSource
final settingsLocalDSProvider = Provider<SettingsLocalDataSource>((ref) {
  final prefs = ref.watch(sharedPreferencesProvider);
  return SettingsLocalDataSource(prefs);
});

/// 3) Repository
final settingsRepositoryProvider = Provider<SettingsRepository>((ref) {
  final ds = ref.watch(settingsLocalDSProvider);
  return SettingsRepositoryImpl(ds);
});

/// 4) UseCase
final settingsUsecaseProvider = Provider<SettingsUsecase>((ref) {
  final repo = ref.watch(settingsRepositoryProvider);
  return SettingsUsecase(repo);
});

/// 5) ğŸ†• í†µí•© ì„¤ì • Provider (ì´ê²ƒë§Œ ì‚¬ìš©!)
final appSettingsProvider = StateNotifierProvider<AppSettingsNotifier, AppSettings>((ref) {
  final usecase = ref.watch(settingsUsecaseProvider);
  return AppSettingsNotifier(usecase);
});

/// ğŸ†• í†µí•© ì„¤ì • ê´€ë¦¬ í´ë˜ìŠ¤
class AppSettingsNotifier extends StateNotifier<AppSettings> {
  final SettingsUsecase _usecase;

  AppSettingsNotifier(this._usecase) : super(const AppSettings()) {
    _loadSettings();
  }

  /// ì´ˆê¸° ì„¤ì • ë¡œë“œ
  Future<void> _loadSettings() async {
    try {
      final settings = await _usecase.getSettings();
      state = settings;
      
      // ì´ˆê¸° í™”ë©´ ì¼œê¸° ìƒíƒœ ì ìš©
      _applyKeepScreen(settings.keepScreenOn);
      
      log.i('âš™ï¸ ì„¤ì • ë¡œë“œ ì™„ë£Œ: ${settings.toString()}');
    } catch (e, st) {
      log.e('ì„¤ì • ë¡œë“œ ì‹¤íŒ¨', e, st);
    }
  }

  /// í…Œë§ˆ ëª¨ë“œ ë³€ê²½
  Future<void> setThemeMode(ThemeMode mode) async {
    try {
      await _usecase.updateThemeMode(mode);
      state = state.copyWith(themeMode: mode);
      log.i('ğŸ¨ í…Œë§ˆ ëª¨ë“œ ë³€ê²½: ${mode.name}');
    } catch (e, st) {
      log.e('í…Œë§ˆ ëª¨ë“œ ë³€ê²½ ì‹¤íŒ¨', e, st);
    }
  }

  /// í™”ë©´ í•­ìƒ ì¼œê¸° ì„¤ì •
  Future<void> setKeepScreenOn(bool keep) async {
    try {
      await _usecase.updateKeepScreenOn(keep);
      state = state.copyWith(keepScreenOn: keep);
      _applyKeepScreen(keep);
      log.i('ğŸ“± í™”ë©´ í•­ìƒ ì¼œê¸°: $keep');
    } catch (e, st) {
      log.e('í™”ë©´ ì¼œê¸° ì„¤ì • ì‹¤íŒ¨', e, st);
    }
  }

  /// ìŠ¬ë¼ì´ë” ìœ„ì¹˜ ë³€ê²½
  Future<void> setSliderPosition(SliderPosition position) async {
    try {
      await _usecase.updateSliderPosition(position);
      state = state.copyWith(sliderPosition: position);
      log.i('ğŸšï¸ ìŠ¬ë¼ì´ë” ìœ„ì¹˜: ${position.name}');
    } catch (e, st) {
      log.e('ìŠ¬ë¼ì´ë” ìœ„ì¹˜ ë³€ê²½ ì‹¤íŒ¨', e, st);
    }
  }

  /// ğŸ†• ì½”ì¸ëª… í‘œì‹œ ë°©ì‹ ë³€ê²½
  Future<void> setDisplayMode(DisplayMode mode) async {
    try {
      await _usecase.updateDisplayMode(mode);
      state = state.copyWith(displayMode: mode);
      log.i('ğŸ’° ì½”ì¸ëª… í‘œì‹œ ë°©ì‹ ë³€ê²½: ${mode.name}');
    } catch (e, st) {
      log.e('ì½”ì¸ëª… í‘œì‹œ ë°©ì‹ ë³€ê²½ ì‹¤íŒ¨', e, st);
    }
  }

  /// ğŸ’° ê¸ˆì•¡ í‘œì‹œ ë°©ì‹ ë³€ê²½
  Future<void> setAmountDisplayMode(AmountDisplayMode mode) async {
    try {
      await _usecase.updateAmountDisplayMode(mode);
      state = state.copyWith(amountDisplayMode: mode);
      log.i('ğŸ’µ ê¸ˆì•¡ í‘œì‹œ ë°©ì‹ ë³€ê²½: ${mode.name}');
    } catch (e, st) {
      log.e('ê¸ˆì•¡ í‘œì‹œ ë°©ì‹ ë³€ê²½ ì‹¤íŒ¨', e, st);
    }
  }

  /// í™”ë©´ ì¼œê¸° ì‹¤ì œ ì ìš©
  void _applyKeepScreen(bool keep) {
    if (keep) {
      WakelockPlus.enable();
    } else {
      WakelockPlus.disable();
    }
  }

  /// ì„¤ì • ìƒˆë¡œê³ ì¹¨
  Future<void> refresh() async {
    await _loadSettings();
  }
}\n\n// ====== lib/shared/widgets/settings_modal.dart ======\n
// lib/shared/widgets/settings_modal.dart
import 'package:flutter/material.dart';
import 'package:flutter/services.dart'; // ğŸ¯ HapticFeedback ì¶”ê°€
import 'package:flutter_riverpod/flutter_riverpod.dart';
import '../../core/di/app_providers.dart';
import '../../domain/entities/app_settings.dart';
import 'theme_mode_segment.dart';
import 'slider_position_segment.dart';

class SettingsModal {
  /// ì„¤ì • ëª¨ë‹¬ í‘œì‹œ
  static void show(BuildContext context) {
    showModalBottomSheet(
      context: context,
      isScrollControlled: true,
      backgroundColor: Colors.transparent,
      barrierColor: Colors.black54,
      builder: (context) => const _SettingsModalContent(),
    );
  }
}

class _SettingsModalContent extends ConsumerWidget {
  const _SettingsModalContent();

  @override
  Widget build(BuildContext context, WidgetRef ref) {
    final settings = ref.watch(appSettingsProvider);
    final controller = ref.read(appSettingsProvider.notifier);

    return Container(
      margin: const EdgeInsets.all(8),
      decoration: BoxDecoration(
        color: Theme.of(context).scaffoldBackgroundColor,
        borderRadius: const BorderRadius.only(
          topLeft: Radius.circular(20),
          topRight: Radius.circular(20),
        ),
        boxShadow: [
          BoxShadow(
            color: Colors.black.withValues(alpha: 0.1),
            blurRadius: 10,
            spreadRadius: 2,
          ),
        ],
      ),
      child: Column(
        mainAxisSize: MainAxisSize.min,
        children: [
          // ğŸ¨ ì„¤ì • ëª¨ë‹¬ í—¤ë”
          _buildHeader(context),
          
          // êµ¬ë¶„ì„ 
          Divider(color: Colors.grey.shade300, height: 1),
          
          // ğŸ¯ ì„¤ì • ë‚´ìš©
          _buildContent(context, settings, controller),
          
          // í•˜ë‹¨ ì—¬ë°±
          SizedBox(height: MediaQuery.of(context).padding.bottom + 20),
        ],
      ),
    );
  }

  /// í—¤ë” (ì œëª© + ë‹«ê¸° ë²„íŠ¼)
  Widget _buildHeader(BuildContext context) {
    return Container(
      padding: const EdgeInsets.symmetric(vertical: 12),
      child: Column(
        children: [
          // ë‹¹ê¹€ í•¸ë“¤
          Container(
            width: 40,
            height: 4,
            decoration: BoxDecoration(
              color: Colors.grey.shade400,
              borderRadius: BorderRadius.circular(2),
            ),
          ),
          const SizedBox(height: 12),
          // ì œëª©ê³¼ ë‹«ê¸° ë²„íŠ¼
          Row(
            children: [
              const SizedBox(width: 16),
              const Icon(Icons.settings, color: Colors.orange),
              const SizedBox(width: 8),
              const Text(
                'ì„¤ì •',
                style: TextStyle(
                  fontSize: 19,
                  fontWeight: FontWeight.bold,
                ),
              ),
              const Spacer(),
              IconButton(
                icon: const Icon(Icons.close),
                onPressed: () => Navigator.of(context).pop(),
              ),
            ],
          ),
        ],
      ),
    );
  }

  /// ì„¤ì • ì»¨í…ì¸ 
  Widget _buildContent(BuildContext context, AppSettings settings, dynamic controller) {
    return Container(
      constraints: const BoxConstraints(maxHeight: 550),
      child: SingleChildScrollView(
        padding: const EdgeInsets.all(16),
        child: Column(
          children: [
            // ğŸ¨ í…Œë§ˆ ì„¤ì •
            Card(
              elevation: 2,
              child: ListTile(
                leading: const Icon(Icons.palette, color: Colors.orange),
                title: const Text(
                  'í…Œë§ˆ',
                  style: TextStyle(fontSize: 15, fontWeight: FontWeight.bold),
                ),
                trailing: ThemeModeSegment(
                  value: settings.themeMode,
                  onChanged: (ThemeMode mode) {
                    HapticFeedback.lightImpact(); // ğŸ¯ í–…í‹± ì¶”ê°€
                    controller.setThemeMode(mode);
                  },
                ),
              ),
            ),
            
            const SizedBox(height: 12),
            
            // ğŸ’° ì½”ì¸ëª… í‘œì‹œ ë°©ì‹
            Card(
              elevation: 2,
              child: ListTile(
                leading: const Icon(Icons.monetization_on, color: Colors.orange),
                title: const Text(
                  'ì½”ì¸ëª… í‘œì‹œ',
                  style: TextStyle(fontSize: 15, fontWeight: FontWeight.bold),
                ),
                subtitle: Text(
                  _getDisplayModeDescription(settings.displayMode),
                  style: const TextStyle(fontSize: 11),
                ),
                trailing: _DisplayModeSegment(
                  value: settings.displayMode,
                  onChanged: (DisplayMode mode) {
                    HapticFeedback.lightImpact(); // ğŸ¯ í–…í‹± ì¶”ê°€
                    controller.setDisplayMode(mode);
                  },
                ),
              ),
            ),
            
            const SizedBox(height: 12),
            
            // ğŸ’µ ê¸ˆì•¡ í‘œì‹œ ë°©ì‹
            Card(
              elevation: 2,
              child: ListTile(
                leading: const Icon(Icons.account_balance_wallet, color: Colors.orange),
                title: const Text(
                  'ê¸ˆì•¡ í‘œì‹œ',
                  style: TextStyle(fontSize: 15, fontWeight: FontWeight.bold),
                ),
                subtitle: Text(
                  _getAmountDisplayModeDescription(settings.amountDisplayMode),
                  style: const TextStyle(fontSize: 11),
                ),
                trailing: _AmountDisplayModeSegment(
                  value: settings.amountDisplayMode,
                  onChanged: (AmountDisplayMode mode) {
                    HapticFeedback.lightImpact(); // ğŸ¯ í–…í‹± ì¶”ê°€
                    controller.setAmountDisplayMode(mode);
                  },
                ),
              ),
            ),
            
            const SizedBox(height: 12),
            
            // ğŸ“± í™”ë©´ í•­ìƒ ì¼œê¸°
            Card(
              elevation: 2,
              child: SwitchListTile(
                secondary: const Icon(Icons.screen_lock_rotation, color: Colors.orange),
                title: const Text(
                  'í™”ë©´ í•­ìƒ ì¼œê¸°',
                  style: TextStyle(fontSize: 15, fontWeight: FontWeight.bold),
                ),
                subtitle: Text(
                  settings.keepScreenOn
                    ? 'í™”ë©´ì´ ìë™ìœ¼ë¡œ êº¼ì§€ì§€ ì•ŠìŠµë‹ˆë‹¤'
                    : 'ì‹œìŠ¤í…œ ì„¤ì •ì— ë”°ë¼ í™”ë©´ì´ êº¼ì§‘ë‹ˆë‹¤',
                  style: const TextStyle(fontSize: 11),
                ),
                value: settings.keepScreenOn,
                onChanged: (bool value) {
                  HapticFeedback.lightImpact(); // ğŸ¯ í–…í‹± ì¶”ê°€
                  controller.setKeepScreenOn(value);
                },
                activeColor: Colors.orange,
              ),
            ),
            
            const SizedBox(height: 12),
            
            // ğŸšï¸ ìŠ¬ë¼ì´ë” ìœ„ì¹˜
            Card(
              elevation: 2,
              child: ListTile(
                leading: const Icon(Icons.tune, color: Colors.orange),
                title: const Text(
                  'ìŠ¬ë¼ì´ë” ìœ„ì¹˜',
                  style: TextStyle(fontSize: 15, fontWeight: FontWeight.bold),
                ),
                subtitle: Text(
                  'ìŠ¬ë¼ì´ë”ë¥¼ ${_getSliderPositionText(settings.sliderPosition)}ì— í‘œì‹œ',
                  style: const TextStyle(fontSize: 11),
                ),
                trailing: SliderPositionSegment(
                  value: settings.sliderPosition,
                  onChanged: (SliderPosition position) {
                    HapticFeedback.lightImpact(); // ğŸ¯ í–…í‹± ì¶”ê°€
                    controller.setSliderPosition(position);
                  },
                ),
              ),
            ),
          ],
        ),
      ),
    );
  }

  /// ğŸ†• í‘œì‹œ ëª¨ë“œ ì„¤ëª… í…ìŠ¤íŠ¸
  String _getDisplayModeDescription(DisplayMode mode) {
    switch (mode) {
      case DisplayMode.ticker:
        return 'BTC, ETH, XRP\ní˜•íƒœë¡œ í‘œì‹œ';
      case DisplayMode.korean:
        return 'ë¹„íŠ¸ì½”ì¸, ì´ë”ë¦¬ì›€, ë¦¬í”Œ\ní˜•íƒœë¡œ í‘œì‹œ';
      case DisplayMode.english:
        return 'Bitcoin, Ethereum, Ripple\ní˜•íƒœë¡œ í‘œì‹œ';
    }
  }

  /// ğŸ’° ê¸ˆì•¡ í‘œì‹œ ë°©ì‹ ì„¤ëª… í…ìŠ¤íŠ¸
  String _getAmountDisplayModeDescription(AmountDisplayMode mode) {
    switch (mode) {
      case AmountDisplayMode.number:
        return '1,234ë§Œ\nìˆ«ìë¡œ í‘œì‹œ';
      case AmountDisplayMode.icon:
        return 'ğŸ’µ ì§€í ì•„ì´ì½˜\nìœ¼ë¡œ í‘œì‹œ';
    }
  }

  /// ìŠ¬ë¼ì´ë” ìœ„ì¹˜ í…ìŠ¤íŠ¸
  String _getSliderPositionText(SliderPosition position) {
    return position.name == 'top' ? 'ìƒë‹¨' : 'í•˜ë‹¨';
  }
}

/// ğŸ†• í‘œì‹œ ëª¨ë“œ ì„¸ê·¸ë¨¼íŠ¸ ìœ„ì ¯
class _DisplayModeSegment extends StatelessWidget {
  final DisplayMode value;
  final ValueChanged<DisplayMode> onChanged;

  const _DisplayModeSegment({
    required this.value,
    required this.onChanged,
  });

  @override
  Widget build(BuildContext context) {
    return Container(
      decoration: BoxDecoration(
        borderRadius: BorderRadius.circular(8),
        border: Border.all(color: Colors.grey.shade300),
      ),
      child: Row(
        mainAxisSize: MainAxisSize.min,
        children: [
          _buildSegmentButton(
            context: context,
            mode: DisplayMode.ticker,
            label: 'í‹°ì»¤',
            icon: Icons.code,
          ),
          _buildDivider(),
          _buildSegmentButton(
            context: context,
            mode: DisplayMode.korean,
            label: 'í•œê¸€',
            icon: Icons.language,
          ),
          _buildDivider(),
          _buildSegmentButton(
            context: context,
            mode: DisplayMode.english,
            label: 'ì˜ë¬¸',
            icon: Icons.translate,
          ),
        ],
      ),
    );
  }

  Widget _buildSegmentButton({
    required BuildContext context,
    required DisplayMode mode,
    required String label,
    required IconData icon,
  }) {
    final isSelected = value == mode;
    final color = isSelected ? Colors.orange : Colors.grey.shade600;
    final backgroundColor = isSelected ? Colors.orange.withValues(alpha: 0.1) : Colors.transparent;

    return GestureDetector(
      onTap: () => onChanged(mode),
      child: Container(
        padding: const EdgeInsets.symmetric(horizontal: 8, vertical: 6),
        decoration: BoxDecoration(
          color: backgroundColor,
          borderRadius: BorderRadius.circular(6),
        ),
        child: Column(
          mainAxisSize: MainAxisSize.min,
          children: [
            Icon(icon, size: 16, color: color),
            const SizedBox(height: 2),
            Text(
              label,
              style: TextStyle(
                fontSize: 10,
                color: color,
                fontWeight: isSelected ? FontWeight.bold : FontWeight.normal,
              ),
            ),
          ],
        ),
      ),
    );
  }

  Widget _buildDivider() {
    return Container(
      width: 1,
      height: 30,
      color: Colors.grey.shade300,
    );
  }
}

/// ğŸ’° ê¸ˆì•¡ í‘œì‹œ ë°©ì‹ ì„¸ê·¸ë¨¼íŠ¸ ìœ„ì ¯
class _AmountDisplayModeSegment extends StatelessWidget {
  final AmountDisplayMode value;
  final ValueChanged<AmountDisplayMode> onChanged;

  const _AmountDisplayModeSegment({
    required this.value,
    required this.onChanged,
  });

  @override
  Widget build(BuildContext context) {
    return Container(
      decoration: BoxDecoration(
        borderRadius: BorderRadius.circular(8),
        border: Border.all(color: Colors.grey.shade300),
      ),
      child: Row(
        mainAxisSize: MainAxisSize.min,
        children: [
          _buildSegmentButton(
            context: context,
            mode: AmountDisplayMode.number,
            label: 'ìˆ«ì',
            icon: Icons.format_list_numbered,
          ),
          _buildDivider(),
          _buildSegmentButton(
            context: context,
            mode: AmountDisplayMode.icon,
            label: 'ì•„ì´ì½˜',
            icon: Icons.account_balance_wallet,
          ),
        ],
      ),
    );
  }

  Widget _buildSegmentButton({
    required BuildContext context,
    required AmountDisplayMode mode,
    required String label,
    required IconData icon,
  }) {
    final isSelected = value == mode;
    final color = isSelected ? Colors.orange : Colors.grey.shade600;
    final backgroundColor = isSelected ? Colors.orange.withValues(alpha: 0.1) : Colors.transparent;

    return GestureDetector(
      onTap: () => onChanged(mode),
      child: Container(
        padding: const EdgeInsets.symmetric(horizontal: 12, vertical: 8),
        decoration: BoxDecoration(
          color: backgroundColor,
          borderRadius: BorderRadius.circular(6),
        ),
        child: Column(
          mainAxisSize: MainAxisSize.min,
          children: [
            Icon(icon, size: 18, color: color),
            const SizedBox(height: 2),
            Text(
              label,
              style: TextStyle(
                fontSize: 11,
                color: color,
                fontWeight: isSelected ? FontWeight.bold : FontWeight.normal,
              ),
            ),
          ],
        ),
      ),
    );
  }

  Widget _buildDivider() {
    return Container(
      width: 1,
      height: 36,
      color: Colors.grey.shade300,
    );
  }
}\n\n// ====== lib/data/datasources/settings_local_ds.dart ======\n
import 'package:flutter/material.dart';
import 'package:shared_preferences/shared_preferences.dart';
import '../../domain/entities/app_settings.dart';

class SettingsLocalDataSource {
  final SharedPreferences prefs;

  SettingsLocalDataSource(this.prefs);

  // í…Œë§ˆ ëª¨ë“œ ê´€ë¦¬
  ThemeMode getThemeMode() {
    final themeName = prefs.getString('themeMode') ?? 'system';
    return switch (themeName) {
      'light' => ThemeMode.light,
      'dark' => ThemeMode.dark,
      _ => ThemeMode.system,
    };
  }

  Future<void> saveThemeMode(ThemeMode mode) async {
    await prefs.setString('themeMode', mode.name);
  }

  // í™”ë©´ í•­ìƒ ì¼œê¸° ê´€ë¦¬
  bool getKeepScreenOn() {
    return prefs.getBool('keepScreenOn') ?? false;
  }

  Future<void> saveKeepScreenOn(bool value) async {
    await prefs.setBool('keepScreenOn', value);
  }

  // ìŠ¬ë¼ì´ë” ìœ„ì¹˜ ê´€ë¦¬ (enum)
  SliderPosition getSliderPosition() {
    final raw = prefs.getString('sliderPosition') ?? 'top';
    return raw == 'bottom' ? SliderPosition.bottom : SliderPosition.top;
  }

  Future<void> saveSliderPosition(SliderPosition position) async {
    await prefs.setString('sliderPosition', position.name);
  }

  // ğŸ†• ì½”ì¸ëª… í‘œì‹œ ë°©ì‹ ê´€ë¦¬
  DisplayMode getDisplayMode() {
    final raw = prefs.getString('displayMode') ?? 'ticker';
    return switch (raw) {
      'korean' => DisplayMode.korean,
      'english' => DisplayMode.english,
      _ => DisplayMode.ticker, // ê¸°ë³¸ê°’: ticker
    };
  }

  Future<void> saveDisplayMode(DisplayMode mode) async {
    await prefs.setString('displayMode', mode.name);
  }

  // ğŸ’° ê¸ˆì•¡ í‘œì‹œ ë°©ì‹ ê´€ë¦¬
  AmountDisplayMode getAmountDisplayMode() {
    final raw = prefs.getString('amountDisplayMode') ?? 'number';
    return switch (raw) {
      'icon' => AmountDisplayMode.icon,
      _ => AmountDisplayMode.number, // ê¸°ë³¸ê°’: number
    };
  }

  Future<void> saveAmountDisplayMode(AmountDisplayMode mode) async {
    await prefs.setString('amountDisplayMode', mode.name);
  }
}\n\n// ====== lib/data/repositories/settings_repository_impl.dart ======\n
import 'package:flutter/material.dart';
import '../../domain/entities/app_settings.dart';
import '../../domain/repositories/settings_repository.dart';
import '../datasources/settings_local_ds.dart';

class SettingsRepositoryImpl implements SettingsRepository {
  final SettingsLocalDataSource dataSource;

  SettingsRepositoryImpl(this.dataSource);

  @override
  Future<AppSettings> getSettings() async {
    return AppSettings(
      themeMode: dataSource.getThemeMode(),
      keepScreenOn: dataSource.getKeepScreenOn(),
      sliderPosition: dataSource.getSliderPosition(),
      displayMode: dataSource.getDisplayMode(), // ğŸ†• DisplayMode ë¡œë“œ
      amountDisplayMode: dataSource.getAmountDisplayMode(), // ğŸ’° AmountDisplayMode ë¡œë“œ
    );
  }

  @override
  Future<void> updateThemeMode(ThemeMode mode) async {
    await dataSource.saveThemeMode(mode);
  }

  @override
  Future<void> updateKeepScreenOn(bool value) async {
    await dataSource.saveKeepScreenOn(value);
  }

  @override
  Future<void> updateSliderPosition(SliderPosition position) async {
    await dataSource.saveSliderPosition(position);
  }

  @override
  Future<void> updateDisplayMode(DisplayMode mode) async {
    await dataSource.saveDisplayMode(mode); // ğŸ†• DisplayMode ì €ì¥
  }

  @override
  Future<void> updateAmountDisplayMode(AmountDisplayMode mode) async {
    await dataSource.saveAmountDisplayMode(mode); // ğŸ’° AmountDisplayMode ì €ì¥
  }
}\n\n// ====== lib/domain/repositories/settings_repository.dart ======\n
import 'package:flutter/material.dart';
import '../entities/app_settings.dart';

abstract class SettingsRepository {
  /// í˜„ì¬ ì•± ì„¤ì • ê°€ì ¸ì˜¤ê¸°
  Future<AppSettings> getSettings();

  /// í…Œë§ˆ ëª¨ë“œ ì—…ë°ì´íŠ¸
  Future<void> updateThemeMode(ThemeMode mode);

  /// í™”ë©´ í•­ìƒ ì¼œê¸° ì„¤ì • ì—…ë°ì´íŠ¸
  Future<void> updateKeepScreenOn(bool value);

  /// ìŠ¬ë¼ì´ë” ìœ„ì¹˜ ì—…ë°ì´íŠ¸
  Future<void> updateSliderPosition(SliderPosition position);

  /// ğŸ†• ì½”ì¸ëª… í‘œì‹œ ë°©ì‹ ì—…ë°ì´íŠ¸
  Future<void> updateDisplayMode(DisplayMode mode);

  /// ğŸ’° ê¸ˆì•¡ í‘œì‹œ ë°©ì‹ ì—…ë°ì´íŠ¸
  Future<void> updateAmountDisplayMode(AmountDisplayMode mode);
}\n\n// ====== lib/domain/usecases/settings_usecase.dart ======\n
// lib/domain/usecases/settings_usecase.dart
import 'package:flutter/material.dart';
import '../entities/app_settings.dart';
import '../repositories/settings_repository.dart';

/// ì•± ì„¤ì • ê´€ë ¨ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
class SettingsUsecase {
  final SettingsRepository _repo;

  SettingsUsecase(this._repo);

  Future<AppSettings> getSettings() {
    return _repo.getSettings();
  }

  Future<void> updateThemeMode(ThemeMode mode) {
    return _repo.updateThemeMode(mode);
  }

  Future<void> updateKeepScreenOn(bool on) {
    return _repo.updateKeepScreenOn(on);
  }

  Future<void> updateSliderPosition(SliderPosition pos) {
    return _repo.updateSliderPosition(pos);
  }

  /// ğŸ†• ì½”ì¸ëª… í‘œì‹œ ë°©ì‹ ì—…ë°ì´íŠ¸
  Future<void> updateDisplayMode(DisplayMode mode) {
    return _repo.updateDisplayMode(mode);
  }

  /// ğŸ’° ê¸ˆì•¡ í‘œì‹œ ë°©ì‹ ì—…ë°ì´íŠ¸
  Future<void> updateAmountDisplayMode(AmountDisplayMode mode) {
    return _repo.updateAmountDisplayMode(mode);
  }
}\n\n// ====== lib/domain/entities/app_settings.dart ======\n
import 'package:flutter/material.dart';
import 'package:equatable/equatable.dart';

/// ìŠ¬ë¼ì´ë” ìœ„ì¹˜ë¥¼ í‘œí˜„í•˜ëŠ” enum
enum SliderPosition { top, bottom }

/// ğŸ†• ì½”ì¸ëª… í‘œì‹œ ë°©ì‹ì„ í‘œí˜„í•˜ëŠ” enum
enum DisplayMode {
  ticker, // BTC, ETH, XRP
  korean, // ë¹„íŠ¸ì½”ì¸, ì´ë”ë¦¬ì›€, ë¦¬í”Œ
  english, // Bitcoin, Ethereum, Ripple
}

/// ğŸ’° ê¸ˆì•¡ í‘œì‹œ ë°©ì‹ì„ í‘œí˜„í•˜ëŠ” enum
enum AmountDisplayMode {
  number, // 1,234ë§Œ (ìˆ«ì)
  icon,   // ğŸ’µ (ì•„ì´ì½˜)
}

class AppSettings extends Equatable {
  final ThemeMode themeMode;
  final bool keepScreenOn;
  final SliderPosition sliderPosition;
  final DisplayMode displayMode; // ğŸ†• ì½”ì¸ëª… í‘œì‹œ ë°©ì‹ ì¶”ê°€
  final AmountDisplayMode amountDisplayMode; // ğŸ’° ê¸ˆì•¡ í‘œì‹œ ë°©ì‹ ì¶”ê°€

  const AppSettings({
    this.themeMode = ThemeMode.system,
    this.keepScreenOn = false,
    this.sliderPosition = SliderPosition.top,
    this.displayMode = DisplayMode.ticker, // ğŸ†• ê¸°ë³¸ê°’: í‹°ì»¤
    this.amountDisplayMode = AmountDisplayMode.number, // ğŸ’° ê¸°ë³¸ê°’: ìˆ«ì
  });

  AppSettings copyWith({
    ThemeMode? themeMode,
    bool? keepScreenOn,
    SliderPosition? sliderPosition,
    DisplayMode? displayMode, // ğŸ†• íŒŒë¼ë¯¸í„° ì¶”ê°€
    AmountDisplayMode? amountDisplayMode, // ğŸ’° íŒŒë¼ë¯¸í„° ì¶”ê°€
  }) =>
      AppSettings(
        themeMode: themeMode ?? this.themeMode,
        keepScreenOn: keepScreenOn ?? this.keepScreenOn,
        sliderPosition: sliderPosition ?? this.sliderPosition,
        displayMode: displayMode ?? this.displayMode, // ğŸ†• ë³µì‚¬ ë¡œì§ ì¶”ê°€
        amountDisplayMode: amountDisplayMode ?? this.amountDisplayMode, // ğŸ’° ë³µì‚¬ ë¡œì§ ì¶”ê°€
      );

  @override
  List<Object?> get props => [
        themeMode,
        keepScreenOn,
        sliderPosition,
        displayMode, // ğŸ†• equality ë¹„êµì— ì¶”ê°€
        amountDisplayMode, // ğŸ’° equality ë¹„êµì— ì¶”ê°€
      ];
}\n\n// ====== lib/presentation/providers/settings_provider.dart ======\n
\n\n// ====== lib/presentation/controllers/settings_controller.dart ======\n
\n\n// ====== lib/presentation/pages/settings_page.dart ======\n
// lib/presentation/pages/settings_page.dart
import 'package:flutter/material.dart';
import 'package:flutter_riverpod/flutter_riverpod.dart';
import '../../core/di/app_providers.dart';
import '../../../shared/widgets/theme_mode_segment.dart';
import '../../../shared/widgets/slider_position_segment.dart';

/// ğŸ†• TopSheetì—ì„œ ì‚¬ìš©í•  ì„¤ì • ë‚´ìš©ë§Œ ë‹´ì€ ìœ„ì ¯
class SettingsPageContent extends ConsumerWidget {
  const SettingsPageContent({Key? key}) : super(key: key);

  @override
  Widget build(BuildContext context, WidgetRef ref) {
    final settings = ref.watch(appSettingsProvider);
    final controller = ref.read(appSettingsProvider.notifier);

    return Container(
      constraints: const BoxConstraints(maxHeight: 400), // ìµœëŒ€ ë†’ì´ ì œí•œ
      child: SingleChildScrollView(
        padding: const EdgeInsets.all(16),
        child: Column(
          children: [
            // ğŸ¨ í…Œë§ˆ ì„¤ì •
            Card(
              elevation: 2,
              child: ListTile(
                leading: const Icon(Icons.palette, color: Colors.orange),
                title: const Text(
                  'í™”ë©´ ëª¨ë“œ',
                  style: TextStyle(fontSize: 16, fontWeight: FontWeight.bold),
                ),
                trailing: ThemeModeSegment(
                  value: settings.themeMode,
                  onChanged: controller.setThemeMode,
                ),
              ),
            ),
            const SizedBox(height: 12),

            // ğŸ“± í™”ë©´ í•­ìƒ ì¼œê¸°
            Card(
              elevation: 2,
              child: SwitchListTile(
                secondary: const Icon(Icons.screen_lock_rotation, color: Colors.orange),
                title: const Text(
                  'í™”ë©´ í•­ìƒ ì¼œê¸°',
                  style: TextStyle(fontSize: 16, fontWeight: FontWeight.bold),
                ),
                subtitle: Text(
                  settings.keepScreenOn
                      ? 'í™”ë©´ì´ ìë™ìœ¼ë¡œ êº¼ì§€ì§€ ì•ŠìŠµë‹ˆë‹¤'
                      : 'ì‹œìŠ¤í…œ ì„¤ì •ì— ë”°ë¼ í™”ë©´ì´ êº¼ì§‘ë‹ˆë‹¤'
                ),
                value: settings.keepScreenOn,
                onChanged: controller.setKeepScreenOn,
                activeColor: Colors.orange,
              ),
            ),
            const SizedBox(height: 12),

            // ğŸšï¸ ìŠ¬ë¼ì´ë” ìœ„ì¹˜
            Card(
              elevation: 2,
              child: ListTile(
                leading: const Icon(Icons.tune, color: Colors.orange),
                title: const Text(
                  'ìŠ¬ë¼ì´ë” ìœ„ì¹˜',
                  style: TextStyle(fontSize: 16, fontWeight: FontWeight.bold),
                ),
                subtitle: Text(
                  'í•„í„° ìŠ¬ë¼ì´ë”ë¥¼ ${_getSliderPositionText(settings.sliderPosition)}ì— í‘œì‹œ'
                ),
                trailing: SliderPositionSegment(
                  value: settings.sliderPosition,
                  onChanged: controller.setSliderPosition,
                ),
              ),
            ),
          ],
        ),
      ),
    );
  }

  /// ìŠ¬ë¼ì´ë” ìœ„ì¹˜ í…ìŠ¤íŠ¸
  String _getSliderPositionText(SliderPosition position) {
    return position.name == 'top' ? 'ìƒë‹¨' : 'í•˜ë‹¨';
  }
}

/// ğŸ—‘ï¸ ê¸°ì¡´ SettingsPageëŠ” í˜¸í™˜ì„±ì„ ìœ„í•´ ìœ ì§€ (ì‚¬ìš© ì•ˆ í•¨)
class SettingsPage extends ConsumerWidget {
  const SettingsPage({Key? key}) : super(key: key);

  @override
  Widget build(BuildContext context, WidgetRef ref) {
    return Scaffold(
      appBar: AppBar(
        title: const Text('ì„¤ì •'),
        centerTitle: true,
      ),
      body: const SettingsPageContent(),
    );
  }
}